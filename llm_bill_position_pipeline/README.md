# LLM Bill Position Pipeline

## Download Input & Output Data
Please download `llm_input`, `llm_output`, and `human_validation` from "Replication Data for: lobbying-position" (https://doi.org/10.7910/DVN/D0QWM2).


## llm_annotation
The `llm_annotation.sh` script is used to annotate bill positions mentioned in lobbying report issue texts using a language model.

The script requires 8 arguments to run. Below is a description of each argument, along with example values that can be customized based on the user's setup. This example uses the Azure OpenAI API with the GPT-4 model. `NUM_CORES` specifies how many processes to use for making GPT calls in parallel using multiprocessing.


- `INPUT_PATH`: llm_input/llm_bill_position_input_df.csv
- `OUTPUT_DIR`: llm_output
- `OUTPUT_NAME`: llm_bill_position_prediction_df.csv
- `MODEL`: gpt-4-1106-Preview
- `API_VERSION`: 2023-09-01-preview
- `OPENAI_API_KEY`: <OPENAI_API_KEY>
- `AZURE_ENDPOINT`: <AZURE_ENDPOINT>
- `NUM_CORES`: <NUM_CORES> 


Replace <OPENAI_API_KEY> and <AZURE_ENDPOINT> with your own credentials.
You can run `llm_annotation.sh` using the following command:
```
bash llm_annotation.sh \
llm_input/llm_bill_position_input_df.csv \
llm_output \
llm_bill_position_prediction_df.csv \
gpt-4-1106-Preview \
2023-09-01-preview \
<OPENAI_API_KEY> \
<AZURE_ENDPOINT> \
<NUM_CORES>
```

## postprocess_llm_annotation
After running `llm_annotation.sh`, the labels generated by the language model are merged with the original report information to create the final LLM output.
Use the same <OUTPUT_DIR> and <OUTPUT_NAME> values as specified in `llm_annotation.sh`.
The final result will be saved as <FINAL_OUTPUT_NAME>.

- `REPORT_DF_PATH`: llm_input/llm_bill_position_input_df.csv
- `OUTPUT_DIR`: llm_output
- `OUTPUT_NAME`: llm_bill_position_prediction_df.csv
- `FINAL_OUTPUT_NAME`: llm_bill_position_final_df

You can run `postprocess_llm_annotation.sh` using the following command:
```
bash postprocess_llm_annotation.sh \
llm_input/report_info_df.csv \
llm_output \
llm_bill_position_prediction_df.csv \
llm_bill_position_final_df.csv
```
